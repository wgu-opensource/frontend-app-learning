{"version":3,"file":"UserMessagesProvider.js","names":["_react","_interopRequireWildcard","require","_propTypes","_interopRequireDefault","_UserMessagesContext","_localStorage","_jsxRuntime","_excluded","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","ALERT_TYPES","ERROR","DANGER","SUCCESS","INFO","WELCOME","exports","FLASH_MESSAGES_LOCAL_STORAGE_KEY","addFlashMessage","message","flashMessages","getLocalStorage","Array","isArray","setLocalStorage","popFlashMessages","popLocalStorage","UserMessagesProvider","_ref","children","messages","setMessages","useState","nextId","setNextId","refId","useRef","addFlash","add","code","dismissible","text","type","topic","payload","others","id","current","currentMessages","remove","clear","useEffect","flashMessage","useMemo","jsx","Provider","propTypes","PropTypes","node","defaultProps","_default"],"sources":["../../../src/generic/user-messages/UserMessagesProvider.jsx"],"sourcesContent":["import React, {\n  useState, useRef, useEffect, useMemo,\n} from 'react';\nimport PropTypes from 'prop-types';\n\nimport UserMessagesContext from './UserMessagesContext';\nimport { getLocalStorage, popLocalStorage, setLocalStorage } from '../../data/localStorage';\n\nexport const ALERT_TYPES = {\n  ERROR: 'error',\n  DANGER: 'danger',\n  SUCCESS: 'success',\n  INFO: 'info',\n  WELCOME: 'welcome',\n};\n\nconst FLASH_MESSAGES_LOCAL_STORAGE_KEY = 'UserMessagesProvider.flashMessages';\n\nfunction addFlashMessage(message) {\n  let flashMessages = getLocalStorage(FLASH_MESSAGES_LOCAL_STORAGE_KEY);\n  if (!flashMessages || !Array.isArray(flashMessages)) {\n    flashMessages = [];\n  }\n  flashMessages.push(message);\n  setLocalStorage(FLASH_MESSAGES_LOCAL_STORAGE_KEY, flashMessages);\n}\n\nfunction popFlashMessages() {\n  return popLocalStorage(FLASH_MESSAGES_LOCAL_STORAGE_KEY) || [];\n}\n\nconst UserMessagesProvider = ({ children }) => {\n  // Note: The callbacks (add, remove, clear) below interact with useState in very subtle ways.\n  // When we call setMessages, we always do so with the function-based form of the handler, making\n  // use of the \"current\" state and not relying on lexical scoping to access the state exposed\n  // above with useState.  This is very important and allows us to call multiple \"add\", \"remove\",\n  // or \"clear\" functions in a  single render.  Without it, each call to one of the callbacks\n  // references back to the -original- value of messages instead of the most recent, causing them\n  // all to override each other.  Last one in would win.\n  const [messages, setMessages] = useState([]);\n  const [nextId, setNextId] = useState(1);\n\n  // Because the add, remove, and clear handlers also need to access nextId, we have to do\n  // something a bit different.  There's no way to wait for the \"currentNextId\" in a setMessages\n  // handler.  The alternative is to update a ref, which will always point to the current value by\n  // its very nature.\n  const refId = useRef(nextId);\n\n  /**\n   * Flash messages are a special kind of message that appears once on page refresh.\n   */\n  function addFlash(message) {\n    addFlashMessage(message);\n  }\n\n  function add(message) {\n    const {\n      code, dismissible, text, type, topic, payload, ...others\n    } = message;\n    const id = refId.current;\n    setMessages(currentMessages => [...currentMessages, {\n      code, dismissible, text, type, topic, payload, ...others, id,\n    }]);\n    refId.current += 1;\n    setNextId(refId.current);\n\n    return id;\n  }\n\n  function remove(id) {\n    setMessages(currentMessages => currentMessages.filter(message => message.id !== id));\n  }\n\n  function clear(topic = null) {\n    setMessages(currentMessages => (topic === null ? [] : currentMessages.filter(message => message.topic !== topic)));\n  }\n\n  useEffect(() => {\n    // We only allow flash messages to persist through one refresh, then we clear them out.\n    // If we want persistent messages, then add a 'persist' key to the messages and handle that\n    // as a separate local storage item.\n    const flashMessages = popFlashMessages();\n    flashMessages.forEach(flashMessage => add(flashMessage));\n  }, []);\n\n  const value = useMemo(() => ({\n    add,\n    addFlash,\n    remove,\n    clear,\n    messages,\n  }), [messages]);\n\n  return (\n    <UserMessagesContext.Provider value={value}>\n      {children}\n    </UserMessagesContext.Provider>\n  );\n};\n\nUserMessagesProvider.propTypes = {\n  children: PropTypes.node,\n};\n\nUserMessagesProvider.defaultProps = {\n  children: null,\n};\n\nexport default UserMessagesProvider;\n"],"mappings":"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"}