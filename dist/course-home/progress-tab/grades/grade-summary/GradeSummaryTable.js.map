{"version":3,"file":"GradeSummaryTable.js","names":["_react","_interopRequireDefault","require","_propTypes","_reactRedux","_i18n","_paragon","_modelStore","_AssignmentTypeCell","_DroppableAssignmentFootnote","_GradeSummaryTableFooter","_messages","_jsxRuntime","obj","__esModule","default","GradeSummaryTable","_ref","intl","setAllOfSomeAssignmentTypeIsLocked","courseId","useSelector","state","courseHome","gradingPolicy","assignmentPolicies","gradesFeatureIsFullyLocked","sectionScores","useModel","footnotes","getFootnoteId","assignment","footnoteId","shortLabel","type","replace","hasNoAccessToAssignmentsOfType","assignmentType","subsectionAssignmentsOfType","map","chapter","subsections","filter","subsection","hasGradedAssignment","numPointsPossible","numPointsEarned","flat","length","noAccessToAssignmentsOfType","some","learnerHasAccess","gradeSummaryData","footnoteMarker","numDroppable","push","id","locked","isLocaleRtl","isRtl","getLocale","weight","toFixed","grade","averageGrade","weightedGrade","getAssignmentTypeCell","value","jsx","getCell","className","children","jsxs","Fragment","DataTable","data","itemCount","columns","Header","formatMessage","messages","accessor","Cell","_ref2","headerClassName","_ref3","cellClassName","_ref4","_ref5","Table","propTypes","intlShape","isRequired","PropTypes","func","_default","injectIntl","exports"],"sources":["../../../../../src/course-home/progress-tab/grades/grade-summary/GradeSummaryTable.jsx"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector } from 'react-redux';\n\nimport {\n  getLocale, injectIntl, intlShape, isRtl,\n} from '@edx/frontend-platform/i18n';\nimport { DataTable } from '@edx/paragon';\nimport { useModel } from '../../../../generic/model-store';\n\nimport AssignmentTypeCell from './AssignmentTypeCell';\nimport DroppableAssignmentFootnote from './DroppableAssignmentFootnote';\nimport GradeSummaryTableFooter from './GradeSummaryTableFooter';\n\nimport messages from '../messages';\n\nconst GradeSummaryTable = ({ intl, setAllOfSomeAssignmentTypeIsLocked }) => {\n  const {\n    courseId,\n  } = useSelector(state => state.courseHome);\n\n  const {\n    gradingPolicy: {\n      assignmentPolicies,\n    },\n    gradesFeatureIsFullyLocked,\n    sectionScores,\n  } = useModel('progress', courseId);\n\n  const footnotes = [];\n\n  const getFootnoteId = (assignment) => {\n    const footnoteId = assignment.shortLabel ? assignment.shortLabel : assignment.type;\n    return footnoteId.replace(/[^A-Za-z0-9.-_]+/g, '-');\n  };\n\n  const hasNoAccessToAssignmentsOfType = (assignmentType) => {\n    const subsectionAssignmentsOfType = sectionScores.map((chapter) => chapter.subsections.filter((subsection) => (\n      subsection.assignmentType === assignmentType && subsection.hasGradedAssignment\n      && (subsection.numPointsPossible > 0 || subsection.numPointsEarned > 0)\n    ))).flat();\n    if (subsectionAssignmentsOfType.length) {\n      const noAccessToAssignmentsOfType = !subsectionAssignmentsOfType.some((subsection) => (\n        subsection.learnerHasAccess === true\n      ));\n      if (noAccessToAssignmentsOfType) {\n        setAllOfSomeAssignmentTypeIsLocked(true);\n        return true;\n      }\n    }\n    return false;\n  };\n\n  const gradeSummaryData = assignmentPolicies.map((assignment) => {\n    let footnoteId = '';\n    let footnoteMarker;\n\n    if (assignment.numDroppable > 0) {\n      footnoteId = getFootnoteId(assignment);\n      footnotes.push({\n        id: footnoteId,\n        numDroppable: assignment.numDroppable,\n        assignmentType: assignment.type,\n      });\n\n      footnoteMarker = footnotes.length;\n    }\n\n    const locked = !gradesFeatureIsFullyLocked && hasNoAccessToAssignmentsOfType(assignment.type);\n\n    const isLocaleRtl = isRtl(getLocale());\n\n    return {\n      type: {\n        footnoteId, footnoteMarker, type: assignment.type, locked,\n      },\n      weight: { weight: `${(assignment.weight * 100).toFixed(0)}${isLocaleRtl ? '\\u200f' : ''}%`, locked },\n      grade: { grade: `${(assignment.averageGrade * 100).toFixed(0)}${isLocaleRtl ? '\\u200f' : ''}%`, locked },\n      weightedGrade: { weightedGrade: `${(assignment.weightedGrade * 100).toFixed(0)}${isLocaleRtl ? '\\u200f' : ''}%`, locked },\n    };\n  });\n  const getAssignmentTypeCell = (value) => (\n    <AssignmentTypeCell\n      assignmentType={value.type} // eslint-disable-line react/prop-types\n      footnoteId={value.footnoteId} // eslint-disable-line react/prop-types\n      footnoteMarker={value.footnoteMarker} // eslint-disable-line react/prop-types\n      locked={value.locked} // eslint-disable-line react/prop-types\n    />\n  );\n\n  const getCell = (locked, value) => <span className={locked ? 'greyed-out' : ''}>{value}</span>;\n\n  return (\n    <>\n      <DataTable\n        data={gradeSummaryData}\n        itemCount={gradeSummaryData.length}\n        columns={[\n          {\n            Header: `${intl.formatMessage(messages.assignmentType)}`,\n            accessor: 'type',\n            Cell: ({ value }) => getAssignmentTypeCell(value),\n            headerClassName: 'h5 mb-0',\n          },\n          {\n            Header: `${intl.formatMessage(messages.weight)}`,\n            accessor: 'weight',\n            headerClassName: 'justify-content-end h5 mb-0',\n            Cell: ({ value }) => getCell(value.locked, value.weight),\n            cellClassName: 'text-right small',\n          },\n          {\n            Header: `${intl.formatMessage(messages.grade)}`,\n            accessor: 'grade',\n            headerClassName: 'justify-content-end h5 mb-0',\n            Cell: ({ value }) => getCell(value.locked, value.grade),\n            cellClassName: 'text-right small',\n          },\n          {\n            Header: `${intl.formatMessage(messages.weightedGrade)}`,\n            accessor: 'weightedGrade',\n            headerClassName: 'justify-content-end h5 mb-0 text-right',\n            Cell: ({ value }) => getCell(value.locked, value.weightedGrade),\n            cellClassName: 'text-right font-weight-bold small',\n          },\n        ]}\n      >\n        <DataTable.Table />\n        <GradeSummaryTableFooter />\n      </DataTable>\n\n      {footnotes && (\n        <DroppableAssignmentFootnote footnotes={footnotes} />\n      )}\n    </>\n  );\n};\n\nGradeSummaryTable.propTypes = {\n  intl: intlShape.isRequired,\n  setAllOfSomeAssignmentTypeIsLocked: PropTypes.func.isRequired,\n};\n\nexport default injectIntl(GradeSummaryTable);\n"],"mappings":"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"}