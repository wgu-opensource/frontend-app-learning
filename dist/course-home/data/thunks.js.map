{"version":3,"file":"thunks.js","names":["_logging","require","_frontendPlatform","_api","_modelStore","_slice","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","eventTypes","POST_EVENT","fetchTab","courseId","tab","getTabData","targetUserId","dispatch","fetchTabRequest","courseHomeCourseMetadata","getCourseHomeCourseMetadata","addModel","modelType","model","id","tabDataResult","courseAccess","hasAccess","fetchTabDenied","fetchTabSuccess","e","fetchTabFailure","logError","fetchDatesTab","getDatesTabData","fetchProgressTab","getProgressTabData","parseInt","fetchOutlineTab","getOutlineTabData","fetchLiveTab","getLiveTabIframe","fetchDiscussionTab","dismissWelcomeMessage","postDismissWelcomeMessage","requestCert","postRequestCert","resetDeadlines","postCourseDeadlines","then","response","data","header","link","link_text","linkText","setCallToActionToast","deprecatedSaveCourseGoal","goalKey","deprecatedPostCourseGoals","saveWeeklyLearningGoal","daysPerWeek","subscribedToReminders","postWeeklyLearningGoal","processEvent","eventData","research_event_data","researchEventData","event","camelCaseObject","eventName","executePostFromPostEvent","postData","bodyParams"],"sources":["../../../src/course-home/data/thunks.js"],"sourcesContent":["import { logError } from '@edx/frontend-platform/logging';\nimport { camelCaseObject } from '@edx/frontend-platform';\nimport {\n  executePostFromPostEvent,\n  getCourseHomeCourseMetadata,\n  getDatesTabData,\n  getOutlineTabData,\n  getProgressTabData,\n  postCourseDeadlines,\n  deprecatedPostCourseGoals,\n  postWeeklyLearningGoal,\n  postDismissWelcomeMessage,\n  postRequestCert,\n  getLiveTabIframe,\n} from './api';\n\nimport {\n  addModel,\n} from '../../generic/model-store';\n\nimport {\n  fetchTabDenied,\n  fetchTabFailure,\n  fetchTabRequest,\n  fetchTabSuccess,\n  setCallToActionToast,\n} from './slice';\n\nconst eventTypes = {\n  POST_EVENT: 'post_event',\n};\n\nexport function fetchTab(courseId, tab, getTabData, targetUserId) {\n  return async (dispatch) => {\n    dispatch(fetchTabRequest({ courseId }));\n    try {\n      const courseHomeCourseMetadata = await getCourseHomeCourseMetadata(courseId, 'outline');\n      dispatch(addModel({\n        modelType: 'courseHomeMeta',\n        model: {\n          id: courseId,\n          ...courseHomeCourseMetadata,\n        },\n      }));\n      const tabDataResult = getTabData && await getTabData(courseId, targetUserId);\n      if (tabDataResult) {\n        dispatch(addModel({\n          modelType: tab,\n          model: {\n            id: courseId,\n            ...tabDataResult,\n          },\n        }));\n      }\n      // Disable the access-denied path for now - it caused a regression\n      if (!courseHomeCourseMetadata.courseAccess.hasAccess) {\n        dispatch(fetchTabDenied({ courseId }));\n      } else if (tabDataResult || !getTabData) {\n        dispatch(fetchTabSuccess({\n          courseId,\n          targetUserId,\n        }));\n      }\n    } catch (e) {\n      dispatch(fetchTabFailure({ courseId }));\n      logError(e);\n    }\n  };\n}\n\nexport function fetchDatesTab(courseId) {\n  return fetchTab(courseId, 'dates', getDatesTabData);\n}\n\nexport function fetchProgressTab(courseId, targetUserId) {\n  return fetchTab(courseId, 'progress', getProgressTabData, parseInt(targetUserId, 10) || targetUserId);\n}\n\nexport function fetchOutlineTab(courseId) {\n  return fetchTab(courseId, 'outline', getOutlineTabData);\n}\n\nexport function fetchLiveTab(courseId) {\n  return fetchTab(courseId, 'live', getLiveTabIframe);\n}\n\nexport function fetchDiscussionTab(courseId) {\n  return fetchTab(courseId, 'discussion');\n}\n\nexport function dismissWelcomeMessage(courseId) {\n  return async () => postDismissWelcomeMessage(courseId);\n}\n\nexport function requestCert(courseId) {\n  return async () => postRequestCert(courseId);\n}\n\nexport function resetDeadlines(courseId, model, getTabData) {\n  return async (dispatch) => {\n    postCourseDeadlines(courseId, model).then(response => {\n      const { data } = response;\n      const {\n        header,\n        link,\n        link_text: linkText,\n      } = data;\n      dispatch(getTabData(courseId));\n      dispatch(setCallToActionToast({ header, link, linkText }));\n    });\n  };\n}\n\nexport async function deprecatedSaveCourseGoal(courseId, goalKey) {\n  return deprecatedPostCourseGoals(courseId, goalKey);\n}\n\nexport async function saveWeeklyLearningGoal(courseId, daysPerWeek, subscribedToReminders) {\n  return postWeeklyLearningGoal(courseId, daysPerWeek, subscribedToReminders);\n}\n\nexport function processEvent(eventData, getTabData) {\n  return async (dispatch) => {\n    // Pulling this out early so the data doesn't get camelCased and is easier\n    // to use when it's passed to the backend\n    const { research_event_data: researchEventData } = eventData;\n    const event = camelCaseObject(eventData);\n    if (event.eventName === eventTypes.POST_EVENT) {\n      executePostFromPostEvent(event.postData, researchEventData).then(response => {\n        const { data } = response;\n        const {\n          header,\n          link,\n          link_text: linkText,\n        } = data;\n        dispatch(getTabData(event.postData.bodyParams.courseId));\n        dispatch(setCallToActionToast({ header, link, linkText }));\n      });\n    }\n  };\n}\n"],"mappings":"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"}