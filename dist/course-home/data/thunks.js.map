{"version":3,"sources":["../../../src/course-home/data/thunks.js"],"names":["eventTypes","POST_EVENT","fetchTab","courseId","tab","getTabData","targetUserId","dispatch","courseHomeCourseMetadata","modelType","model","id","tabDataResult","courseAccess","hasAccess","e","fetchDatesTab","getDatesTabData","fetchProgressTab","getProgressTabData","parseInt","fetchOutlineTab","getOutlineTabData","fetchLiveTab","getLiveTabIframe","fetchDiscussionTab","dismissWelcomeMessage","requestCert","resetDeadlines","then","response","data","header","link","link_text","linkText","deprecatedSaveCourseGoal","goalKey","saveWeeklyLearningGoal","daysPerWeek","subscribedToReminders","processEvent","eventData","research_event_data","researchEventData","event","eventName","postData","bodyParams"],"mappings":"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","sourcesContent":["import { logError } from '@edx/frontend-platform/logging';\nimport { camelCaseObject } from '@edx/frontend-platform';\nimport {\n  executePostFromPostEvent,\n  getCourseHomeCourseMetadata,\n  getDatesTabData,\n  getOutlineTabData,\n  getProgressTabData,\n  postCourseDeadlines,\n  deprecatedPostCourseGoals,\n  postWeeklyLearningGoal,\n  postDismissWelcomeMessage,\n  postRequestCert,\n  getLiveTabIframe,\n} from './api';\n\nimport {\n  addModel,\n} from '../../generic/model-store';\n\nimport {\n  fetchTabDenied,\n  fetchTabFailure,\n  fetchTabRequest,\n  fetchTabSuccess,\n  setCallToActionToast,\n} from './slice';\n\nconst eventTypes = {\n  POST_EVENT: 'post_event',\n};\n\nexport function fetchTab(courseId, tab, getTabData, targetUserId) {\n  return async (dispatch) => {\n    dispatch(fetchTabRequest({ courseId }));\n    try {\n      const courseHomeCourseMetadata = await getCourseHomeCourseMetadata(courseId, 'outline');\n      dispatch(addModel({\n        modelType: 'courseHomeMeta',\n        model: {\n          id: courseId,\n          ...courseHomeCourseMetadata,\n        },\n      }));\n      const tabDataResult = getTabData && await getTabData(courseId, targetUserId);\n      if (tabDataResult) {\n        dispatch(addModel({\n          modelType: tab,\n          model: {\n            id: courseId,\n            ...tabDataResult,\n          },\n        }));\n      }\n      // Disable the access-denied path for now - it caused a regression\n      if (!courseHomeCourseMetadata.courseAccess.hasAccess) {\n        dispatch(fetchTabDenied({ courseId }));\n      } else if (tabDataResult || !getTabData) {\n        dispatch(fetchTabSuccess({\n          courseId,\n          targetUserId,\n        }));\n      }\n    } catch (e) {\n      dispatch(fetchTabFailure({ courseId }));\n      logError(e);\n    }\n  };\n}\n\nexport function fetchDatesTab(courseId) {\n  return fetchTab(courseId, 'dates', getDatesTabData);\n}\n\nexport function fetchProgressTab(courseId, targetUserId) {\n  return fetchTab(courseId, 'progress', getProgressTabData, parseInt(targetUserId, 10) || targetUserId);\n}\n\nexport function fetchOutlineTab(courseId) {\n  return fetchTab(courseId, 'outline', getOutlineTabData);\n}\n\nexport function fetchLiveTab(courseId) {\n  return fetchTab(courseId, 'live', getLiveTabIframe);\n}\n\nexport function fetchDiscussionTab(courseId) {\n  return fetchTab(courseId, 'discussion');\n}\n\nexport function dismissWelcomeMessage(courseId) {\n  return async () => postDismissWelcomeMessage(courseId);\n}\n\nexport function requestCert(courseId) {\n  return async () => postRequestCert(courseId);\n}\n\nexport function resetDeadlines(courseId, model, getTabData) {\n  return async (dispatch) => {\n    postCourseDeadlines(courseId, model).then(response => {\n      const { data } = response;\n      const {\n        header,\n        link,\n        link_text: linkText,\n      } = data;\n      dispatch(getTabData(courseId));\n      dispatch(setCallToActionToast({ header, link, linkText }));\n    });\n  };\n}\n\nexport async function deprecatedSaveCourseGoal(courseId, goalKey) {\n  return deprecatedPostCourseGoals(courseId, goalKey);\n}\n\nexport async function saveWeeklyLearningGoal(courseId, daysPerWeek, subscribedToReminders) {\n  return postWeeklyLearningGoal(courseId, daysPerWeek, subscribedToReminders);\n}\n\nexport function processEvent(eventData, getTabData) {\n  return async (dispatch) => {\n    // Pulling this out early so the data doesn't get camelCased and is easier\n    // to use when it's passed to the backend\n    const { research_event_data: researchEventData } = eventData;\n    const event = camelCaseObject(eventData);\n    if (event.eventName === eventTypes.POST_EVENT) {\n      executePostFromPostEvent(event.postData, researchEventData).then(response => {\n        const { data } = response;\n        const {\n          header,\n          link,\n          link_text: linkText,\n        } = data;\n        dispatch(getTabData(event.postData.bodyParams.courseId));\n        dispatch(setCallToActionToast({ header, link, linkText }));\n      });\n    }\n  };\n}\n"],"file":"thunks.js"}