{"version":3,"file":"StreakCelebrationModal.js","names":["_react","_interopRequireWildcard","require","_propTypes","_interopRequireDefault","_frontendPlatform","_analytics","_auth","_i18n","_icons","_paragon","_reactRedux","_upgradeButton","_modelStore","_Streak_mobile","_Streak_desktop","_messages","_utils","_jsxRuntime","_excluded","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","getRandomFactoid","intl","streakLength","boldedSectionA","formatMessage","messages","streakFactoidABoldedSection","boldedSectionB","streakFactoidBBoldedSection","factoids","jsx","FormattedMessage","id","defaultMessage","values","bolded_section","children","streak_length","Math","floor","random","calculateVoucherDiscount","voucher","sku","username","urlBase","getConfig","ECOMMERCE_BASE_URL","url","getAuthenticatedHttpClient","then","camelCaseObject","CloseText","_ref","jsxs","streakButton","className","streakButtonSrOnly","StreakModal","_ref2","courseId","metadataModel","streakLengthToCelebrate","isStreakCelebrationOpen","closeStreakCelebration","streakDiscountCouponEnabled","verifiedMode","rest","org","celebrations","useModel","factoid","randomFactoid","setRandomFactoid","useState","discountCode","discountPercent","setDiscountPercent","queryingDiscount","wideScreen","useWindowSize","width","breakpoints","small","minWidth","dispatch","useDispatch","useEffect","recordStreakCelebration","result","totalInclTax","totalInclTaxExclDiscounts","data","sendTrackEvent","course_id","upgradeUrl","mode","offer","currencySymbol","price","discountMultipler","discountedPrice","toFixed","toString","originalPrice","title","streakHeader","showOffer","ModalDialog","onClose","recordModalClosing","isOpen","isFullscreenScroll","Header","Title","Body","streakBody","src","StreakMobileImage","alt","StreakDesktopImage","Spinner","animation","variant","Icon","Lightbulb","Alert","MoneyFilled","congratulations","streakDiscountMessage","percent","date","Date","now","toLocaleDateString","timeZone","Footer","Fragment","UpgradeNowButton","size","CloseButton","streakButtonAA759","defaultProps","propTypes","PropTypes","string","isRequired","number","intlShape","bool","func","shape","_default","injectIntl","exports"],"sources":["../../../src/shared/streak-celebration/StreakCelebrationModal.jsx"],"sourcesContent":["/* eslint-disable react/prop-types */\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { camelCaseObject, getConfig } from '@edx/frontend-platform';\nimport { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport { getAuthenticatedHttpClient } from '@edx/frontend-platform/auth';\nimport {\n  FormattedMessage, injectIntl, intlShape,\n} from '@edx/frontend-platform/i18n';\nimport { Lightbulb, MoneyFilled } from '@edx/paragon/icons';\nimport {\n  Alert, breakpoints, Icon, ModalDialog, Spinner, useWindowSize,\n} from '@edx/paragon';\nimport { useDispatch } from 'react-redux';\nimport { UpgradeNowButton } from '../../generic/upgrade-button';\n\nimport { useModel } from '../../generic/model-store';\nimport StreakMobileImage from './assets/Streak_mobile.png';\nimport StreakDesktopImage from './assets/Streak_desktop.png';\nimport messages from './messages';\nimport { recordModalClosing, recordStreakCelebration } from './utils';\n\nfunction getRandomFactoid(intl, streakLength) {\n  const boldedSectionA = intl.formatMessage(messages.streakFactoidABoldedSection);\n  const boldedSectionB = intl.formatMessage(messages.streakFactoidBBoldedSection);\n  const factoids = [\n    (<FormattedMessage\n      id=\"learning.streakcelebration.factoida\"\n      defaultMessage=\"Users who learn {streak_length} days in a row {bolded_section} than those who don’t.\"\n      values={{\n        bolded_section: (<b>{boldedSectionA}</b>),\n        streak_length: (streakLength),\n      }}\n    />),\n    (<FormattedMessage\n      id=\"learning.streakcelebration.factoidb\"\n      defaultMessage=\"Users who learn {streak_length} days in a row {bolded_section} vs. those who don’t.\"\n      values={{\n        bolded_section: (<b>{boldedSectionB}</b>),\n        streak_length: (streakLength),\n      }}\n    />),\n  ];\n  return factoids[Math.floor(Math.random() * (factoids.length))];\n}\n\nasync function calculateVoucherDiscount(voucher, sku, username) {\n  const urlBase = `${getConfig().ECOMMERCE_BASE_URL}/api/v2/baskets/calculate`;\n  const url = `${urlBase}/?code=${voucher}&sku=${sku}&username=${username}`;\n  return getAuthenticatedHttpClient().get(url)\n    .then(res => camelCaseObject(res));\n}\n\nconst CloseText = ({ intl }) => (\n  <span>\n    {intl.formatMessage(messages.streakButton)}\n    <span className=\"sr-only\">. {intl.formatMessage(messages.streakButtonSrOnly)}</span>\n  </span>\n);\n\nconst StreakModal = ({\n  courseId, metadataModel, streakLengthToCelebrate, intl, isStreakCelebrationOpen,\n  closeStreakCelebration, streakDiscountCouponEnabled, verifiedMode, ...rest\n}) => {\n  const { org, celebrations, username } = useModel('courseHomeMeta', courseId);\n  const factoid = getRandomFactoid(intl, streakLengthToCelebrate);\n  // eslint-disable-next-line no-unused-vars\n  const [randomFactoid, setRandomFactoid] = useState(factoid); // Don't change factoid on re-render\n\n  // Open edX Folks: if you create a voucher with this code, the MFE will notice and show the discount\n  const discountCode = 'ZGY11119949';\n  // Negative means \"we don't know yet\" vs zero meaning no discount available\n  const [discountPercent, setDiscountPercent] = useState(-1);\n  const queryingDiscount = discountPercent < 0;\n\n  const wideScreen = useWindowSize().width >= breakpoints.small.minWidth;\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (isStreakCelebrationOpen) {\n      recordStreakCelebration(org, courseId);\n    }\n  }, [isStreakCelebrationOpen, org, courseId]);\n\n  // Ask ecommerce to calculate discount savings\n  useEffect(() => {\n    if (streakDiscountCouponEnabled && verifiedMode && getConfig().ECOMMERCE_BASE_URL) {\n      calculateVoucherDiscount(discountCode, verifiedMode.sku, username)\n        .then(\n          (result) => {\n            const { totalInclTax, totalInclTaxExclDiscounts } = result.data;\n            if (totalInclTaxExclDiscounts && totalInclTax !== totalInclTaxExclDiscounts) {\n              // Just store the percent (rather than using these values directly), because ecommerce doesn't give us\n              // the currency symbol to use, so we want to use the symbol that LMS gives us. And I don't want to assume\n              // ecommerce's currency is the same as the LMS. So we'll keep using the values in verifiedMode, just\n              // multiplied by the calculated percentage.\n              setDiscountPercent(1 - totalInclTax / totalInclTaxExclDiscounts);\n              sendTrackEvent('edx.bi.course.streak_discount_enabled', {\n                course_id: courseId,\n                sku: verifiedMode.sku,\n              });\n            } else {\n              setDiscountPercent(0);\n            }\n          },\n          () => {\n            // ignore any errors - we just won't show the discount to the user then\n            setDiscountPercent(0);\n          },\n        );\n    } else {\n      setDiscountPercent(0);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [streakDiscountCouponEnabled, username, verifiedMode]);\n\n  if (!isStreakCelebrationOpen) {\n    return null;\n  }\n\n  let upgradeUrl;\n  let mode;\n  let offer;\n\n  if (verifiedMode) {\n    upgradeUrl = `${verifiedMode.upgradeUrl}`;\n    mode = {\n      currencySymbol: verifiedMode.currencySymbol,\n      price: verifiedMode.price,\n      upgradeUrl,\n    };\n\n    if (discountPercent > 0) {\n      const discountMultipler = 1 - discountPercent;\n      offer = {\n        discountedPrice: `${verifiedMode.currencySymbol}${(mode.price * discountMultipler).toFixed(2).toString()}`,\n        originalPrice: `${verifiedMode.currencySymbol}${mode.price.toString()}`,\n        upgradeUrl: `${mode.upgradeUrl}&code=${discountCode}`,\n      };\n    }\n  }\n\n  const title = `${streakLengthToCelebrate} ${intl.formatMessage(messages.streakHeader)}`;\n  const showOffer = offer && streakDiscountCouponEnabled;\n\n  return (\n    <ModalDialog\n      className=\"streak-modal modal-dialog-centered\"\n      title={title}\n      onClose={() => {\n        closeStreakCelebration();\n        recordModalClosing(celebrations, org, courseId, dispatch);\n      }}\n      isOpen={isStreakCelebrationOpen}\n      isFullscreenScroll\n      {...rest}\n    >\n      <ModalDialog.Header className=\"modal-header\">\n        <ModalDialog.Title className=\"mr-0 modal-title\">\n          {title}\n        </ModalDialog.Title>\n      </ModalDialog.Header>\n      <ModalDialog.Body className=\"modal-body\">\n        <p className=\"text-center\">{intl.formatMessage(messages.streakBody)}</p>\n        <p className=\"modal-image text-center\">\n          {!wideScreen && <img src={StreakMobileImage} alt=\"\" className=\"img-fluid\" />}\n          {wideScreen && <img src={StreakDesktopImage} alt=\"\" className=\"img-fluid\" />}\n        </p>\n        { queryingDiscount && (\n          <Spinner animation=\"border\" variant=\"primary\" />\n        )}\n        { !queryingDiscount && !showOffer && (\n          <div className=\"d-flex py-3 bg-light-300\">\n            <Icon className=\"col-small ml-3\" src={Lightbulb} />\n            <div className=\"col-11 factoid-wrapper\">\n              {randomFactoid}\n            </div>\n          </div>\n        )}\n        { !queryingDiscount && showOffer && (\n          <Alert variant=\"success\" className=\"px-0\">\n            <div className=\"d-flex\">\n              <Icon className=\"col-small ml-3 text-success-500\" src={MoneyFilled} />\n              <div className=\"col-11 factoid-wrapper\">\n                <b>{intl.formatMessage(messages.congratulations)}</b>\n                &nbsp;{intl.formatMessage(messages.streakDiscountMessage, {\n                  percent: (discountPercent * 100).toFixed(0),\n                })}&nbsp;\n                <FormattedMessage\n                  id=\"learning.streakCelebration.streakCelebrationCouponEndDateMessage\"\n                  defaultMessage=\"Ends {date}.\"\n                  values={{\n                    date: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toLocaleDateString({ timeZone: 'UTC' }),\n                  }}\n                />\n              </div>\n            </div>\n          </Alert>\n        )}\n      </ModalDialog.Body>\n      <ModalDialog.Footer className=\"modal-footer d-block\">\n        { !queryingDiscount && showOffer && (\n          <>\n            {!wideScreen && (\n              <>\n                <UpgradeNowButton\n                  className=\"upgrade mb-3\"\n                  size=\"sm\"\n                  offer={offer}\n                  variant=\"brand\"\n                  verifiedMode={mode}\n                />\n                <ModalDialog.CloseButton variant=\"outline-brand\" className=\"btn-sm\">\n                  {intl.formatMessage(messages.streakButtonAA759)}\n                </ModalDialog.CloseButton>\n              </>\n            )}\n            {wideScreen && (\n              <>\n                <UpgradeNowButton\n                  className=\"upgrade mb-3\"\n                  offer={offer}\n                  variant=\"brand\"\n                  verifiedMode={mode}\n                />\n                <ModalDialog.CloseButton variant=\"outline-brand\">\n                  {intl.formatMessage(messages.streakButtonAA759)}\n                </ModalDialog.CloseButton>\n              </>\n            )}\n          </>\n        )}\n        { !queryingDiscount && !showOffer && (\n          <ModalDialog.CloseButton className=\"px-5\" variant=\"primary\"><CloseText intl={intl} /></ModalDialog.CloseButton>\n        )}\n      </ModalDialog.Footer>\n    </ModalDialog>\n  );\n};\n\nStreakModal.defaultProps = {\n  isStreakCelebrationOpen: false,\n  streakDiscountCouponEnabled: false,\n  streakLengthToCelebrate: -1,\n  verifiedMode: {},\n};\n\nStreakModal.propTypes = {\n  courseId: PropTypes.string.isRequired,\n  metadataModel: PropTypes.string.isRequired,\n  streakLengthToCelebrate: PropTypes.number,\n  intl: intlShape.isRequired,\n  isStreakCelebrationOpen: PropTypes.bool,\n  closeStreakCelebration: PropTypes.func.isRequired,\n  streakDiscountCouponEnabled: PropTypes.bool,\n  verifiedMode: PropTypes.shape({\n    currencySymbol: PropTypes.string,\n    price: PropTypes.number,\n    sku: PropTypes.string,\n    upgradeUrl: PropTypes.string,\n  }),\n};\n\nexport default injectIntl(StreakModal);\n"],"mappings":"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"}