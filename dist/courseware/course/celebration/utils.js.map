{"version":3,"file":"utils.js","names":["_analytics","require","_auth","_api","_localStorage","_modelStore","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","CELEBRATION_LOCAL_STORAGE_KEY","handleNextSectionCelebration","sequenceId","nextSequenceId","setLocalStorage","prevSequenceId","recordFirstSectionCelebration","org","courseId","celebrations","dispatch","postCelebrationComplete","first_section","updateModel","modelType","model","id","firstSection","administrator","getAuthenticatedUser","sendTrackEvent","org_key","courserun_key","course_id","is_staff","recordWeeklyGoalCelebration","weekly_goal","shouldCelebrateOnSectionLoad","celebrateFirstSection","celebrationIds","getLocalStorage","onTargetSequence","shouldCelebrate","streakLengthToCelebrate","clearLocalStorage"],"sources":["../../../../src/courseware/course/celebration/utils.jsx"],"sourcesContent":["import { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport { getAuthenticatedUser } from '@edx/frontend-platform/auth';\n\nimport { postCelebrationComplete } from './data/api';\nimport { clearLocalStorage, getLocalStorage, setLocalStorage } from '../../../data/localStorage';\nimport { updateModel } from '../../../generic/model-store';\n\nconst CELEBRATION_LOCAL_STORAGE_KEY = 'CelebrationModal.showOnSectionLoad';\n\n// Records clicks through the end of a section, so that we can know whether we should celebrate when we finish loading\nfunction handleNextSectionCelebration(sequenceId, nextSequenceId) {\n  setLocalStorage(CELEBRATION_LOCAL_STORAGE_KEY, {\n    prevSequenceId: sequenceId,\n    nextSequenceId,\n  });\n}\n\nfunction recordFirstSectionCelebration(org, courseId, celebrations, dispatch) {\n  // Tell the LMS\n  postCelebrationComplete(courseId, { first_section: false });\n  // Update our local copy of course data from LMS\n  dispatch(updateModel({\n    modelType: 'courseHomeMeta',\n    model: {\n      id: courseId,\n      celebrations: {\n        ...celebrations,\n        firstSection: false,\n      },\n    },\n  }));\n\n  // Tell our analytics\n  const { administrator } = getAuthenticatedUser();\n  sendTrackEvent('edx.ui.lms.celebration.first_section.opened', {\n    org_key: org,\n    courserun_key: courseId,\n    course_id: courseId, // should only be courserun_key, but left as-is for historical reasons\n    is_staff: administrator,\n  });\n}\n\nfunction recordWeeklyGoalCelebration(org, courseId) {\n  // Tell the LMS\n  postCelebrationComplete(courseId, { weekly_goal: false });\n\n  // Tell our analytics\n  const { administrator } = getAuthenticatedUser();\n  sendTrackEvent('edx.ui.lms.celebration.weekly_goal.opened', {\n    org_key: org,\n    courserun_key: courseId,\n    is_staff: administrator,\n  });\n}\n\n// Looks at local storage to see whether we just came from the end of a section.\n// Note! This does have side effects (will clear some local storage and may start an api call).\nfunction shouldCelebrateOnSectionLoad(courseId, sequenceId, celebrateFirstSection, dispatch, celebrations) {\n  const celebrationIds = getLocalStorage(CELEBRATION_LOCAL_STORAGE_KEY);\n  if (!celebrationIds) {\n    return false;\n  }\n\n  const {\n    prevSequenceId,\n    nextSequenceId,\n  } = celebrationIds;\n  const onTargetSequence = sequenceId === nextSequenceId;\n  let shouldCelebrate = onTargetSequence && celebrateFirstSection;\n\n  if (shouldCelebrate && celebrations.streakLengthToCelebrate) {\n    // We don't want two modals to show up on the same page.\n    // If we are going to celebrate a streak then we will not also celebrate the first section.\n    // We will still mark the first section as celebrated, so that we don't incorrectly celebrate the second section.\n    shouldCelebrate = false;\n    postCelebrationComplete(courseId, { first_section: false });\n  }\n\n  if (sequenceId !== prevSequenceId && !onTargetSequence) {\n    // Don't clear until we move off of current/prev sequence\n    clearLocalStorage(CELEBRATION_LOCAL_STORAGE_KEY);\n\n    // Update our local copy of course data from LMS\n    dispatch(updateModel({\n      modelType: 'courseHomeMeta',\n      model: {\n        id: courseId,\n        celebrations: {\n          ...celebrations,\n          firstSection: false,\n        },\n      },\n    }));\n  }\n\n  return shouldCelebrate;\n}\n\nexport {\n  handleNextSectionCelebration,\n  recordFirstSectionCelebration,\n  recordWeeklyGoalCelebration,\n  shouldCelebrateOnSectionLoad,\n};\n"],"mappings":";;;;;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AAEA,IAAAE,IAAA,GAAAF,OAAA;AACA,IAAAG,aAAA,GAAAH,OAAA;AACA,IAAAI,WAAA,GAAAJ,OAAA;AAA2D,SAAAK,QAAAC,MAAA,EAAAC,cAAA,QAAAC,IAAA,GAAAC,MAAA,CAAAD,IAAA,CAAAF,MAAA,OAAAG,MAAA,CAAAC,qBAAA,QAAAC,OAAA,GAAAF,MAAA,CAAAC,qBAAA,CAAAJ,MAAA,GAAAC,cAAA,KAAAI,OAAA,GAAAA,OAAA,CAAAC,MAAA,WAAAC,GAAA,WAAAJ,MAAA,CAAAK,wBAAA,CAAAR,MAAA,EAAAO,GAAA,EAAAE,UAAA,OAAAP,IAAA,CAAAQ,IAAA,CAAAC,KAAA,CAAAT,IAAA,EAAAG,OAAA,YAAAH,IAAA;AAAA,SAAAU,cAAAC,MAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAF,CAAA,UAAAG,MAAA,WAAAF,SAAA,CAAAD,CAAA,IAAAC,SAAA,CAAAD,CAAA,QAAAA,CAAA,OAAAf,OAAA,CAAAI,MAAA,CAAAc,MAAA,OAAAC,OAAA,WAAAC,GAAA,IAAAC,eAAA,CAAAP,MAAA,EAAAM,GAAA,EAAAF,MAAA,CAAAE,GAAA,SAAAhB,MAAA,CAAAkB,yBAAA,GAAAlB,MAAA,CAAAmB,gBAAA,CAAAT,MAAA,EAAAV,MAAA,CAAAkB,yBAAA,CAAAJ,MAAA,KAAAlB,OAAA,CAAAI,MAAA,CAAAc,MAAA,GAAAC,OAAA,WAAAC,GAAA,IAAAhB,MAAA,CAAAoB,cAAA,CAAAV,MAAA,EAAAM,GAAA,EAAAhB,MAAA,CAAAK,wBAAA,CAAAS,MAAA,EAAAE,GAAA,iBAAAN,MAAA;AAAA,SAAAO,gBAAAI,GAAA,EAAAL,GAAA,EAAAM,KAAA,IAAAN,GAAA,GAAAO,cAAA,CAAAP,GAAA,OAAAA,GAAA,IAAAK,GAAA,IAAArB,MAAA,CAAAoB,cAAA,CAAAC,GAAA,EAAAL,GAAA,IAAAM,KAAA,EAAAA,KAAA,EAAAhB,UAAA,QAAAkB,YAAA,QAAAC,QAAA,oBAAAJ,GAAA,CAAAL,GAAA,IAAAM,KAAA,WAAAD,GAAA;AAAA,SAAAE,eAAAG,GAAA,QAAAV,GAAA,GAAAW,YAAA,CAAAD,GAAA,2BAAAV,GAAA,gBAAAA,GAAA,GAAAY,MAAA,CAAAZ,GAAA;AAAA,SAAAW,aAAAE,KAAA,EAAAC,IAAA,eAAAD,KAAA,iBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAG,MAAA,CAAAC,WAAA,OAAAF,IAAA,KAAAG,SAAA,QAAAC,GAAA,GAAAJ,IAAA,CAAAK,IAAA,CAAAP,KAAA,EAAAC,IAAA,2BAAAK,GAAA,sBAAAA,GAAA,YAAAE,SAAA,4DAAAP,IAAA,gBAAAF,MAAA,GAAAU,MAAA,EAAAT,KAAA;AAE3D,MAAMU,6BAA6B,GAAG,oCAAoC;;AAE1E;AACA,SAASC,4BAA4BA,CAACC,UAAU,EAAEC,cAAc,EAAE;EAChE,IAAAC,6BAAe,EAACJ,6BAA6B,EAAE;IAC7CK,cAAc,EAAEH,UAAU;IAC1BC;EACF,CAAC,CAAC;AACJ;AAEA,SAASG,6BAA6BA,CAACC,GAAG,EAAEC,QAAQ,EAAEC,YAAY,EAAEC,QAAQ,EAAE;EAC5E;EACA,IAAAC,4BAAuB,EAACH,QAAQ,EAAE;IAAEI,aAAa,EAAE;EAAM,CAAC,CAAC;EAC3D;EACAF,QAAQ,CAAC,IAAAG,uBAAW,EAAC;IACnBC,SAAS,EAAE,gBAAgB;IAC3BC,KAAK,EAAE;MACLC,EAAE,EAAER,QAAQ;MACZC,YAAY,EAAAvC,aAAA,CAAAA,aAAA,KACPuC,YAAY;QACfQ,YAAY,EAAE;MAAK;IAEvB;EACF,CAAC,CAAC,CAAC;;EAEH;EACA,MAAM;IAAEC;EAAc,CAAC,GAAG,IAAAC,0BAAoB,EAAC,CAAC;EAChD,IAAAC,yBAAc,EAAC,6CAA6C,EAAE;IAC5DC,OAAO,EAAEd,GAAG;IACZe,aAAa,EAAEd,QAAQ;IACvBe,SAAS,EAAEf,QAAQ;IAAE;IACrBgB,QAAQ,EAAEN;EACZ,CAAC,CAAC;AACJ;AAEA,SAASO,2BAA2BA,CAAClB,GAAG,EAAEC,QAAQ,EAAE;EAClD;EACA,IAAAG,4BAAuB,EAACH,QAAQ,EAAE;IAAEkB,WAAW,EAAE;EAAM,CAAC,CAAC;;EAEzD;EACA,MAAM;IAAER;EAAc,CAAC,GAAG,IAAAC,0BAAoB,EAAC,CAAC;EAChD,IAAAC,yBAAc,EAAC,2CAA2C,EAAE;IAC1DC,OAAO,EAAEd,GAAG;IACZe,aAAa,EAAEd,QAAQ;IACvBgB,QAAQ,EAAEN;EACZ,CAAC,CAAC;AACJ;;AAEA;AACA;AACA,SAASS,4BAA4BA,CAACnB,QAAQ,EAAEN,UAAU,EAAE0B,qBAAqB,EAAElB,QAAQ,EAAED,YAAY,EAAE;EACzG,MAAMoB,cAAc,GAAG,IAAAC,6BAAe,EAAC9B,6BAA6B,CAAC;EACrE,IAAI,CAAC6B,cAAc,EAAE;IACnB,OAAO,KAAK;EACd;EAEA,MAAM;IACJxB,cAAc;IACdF;EACF,CAAC,GAAG0B,cAAc;EAClB,MAAME,gBAAgB,GAAG7B,UAAU,KAAKC,cAAc;EACtD,IAAI6B,eAAe,GAAGD,gBAAgB,IAAIH,qBAAqB;EAE/D,IAAII,eAAe,IAAIvB,YAAY,CAACwB,uBAAuB,EAAE;IAC3D;IACA;IACA;IACAD,eAAe,GAAG,KAAK;IACvB,IAAArB,4BAAuB,EAACH,QAAQ,EAAE;MAAEI,aAAa,EAAE;IAAM,CAAC,CAAC;EAC7D;EAEA,IAAIV,UAAU,KAAKG,cAAc,IAAI,CAAC0B,gBAAgB,EAAE;IACtD;IACA,IAAAG,+BAAiB,EAAClC,6BAA6B,CAAC;;IAEhD;IACAU,QAAQ,CAAC,IAAAG,uBAAW,EAAC;MACnBC,SAAS,EAAE,gBAAgB;MAC3BC,KAAK,EAAE;QACLC,EAAE,EAAER,QAAQ;QACZC,YAAY,EAAAvC,aAAA,CAAAA,aAAA,KACPuC,YAAY;UACfQ,YAAY,EAAE;QAAK;MAEvB;IACF,CAAC,CAAC,CAAC;EACL;EAEA,OAAOe,eAAe;AACxB"}