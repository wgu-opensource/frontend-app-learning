{"version":3,"file":"NotificationTrigger.js","names":["_i18n","require","_propTypes","_interopRequireDefault","_react","_interopRequireWildcard","_localStorage","_sessionStorage","_messages","_TriggerBase","_SidebarContext","_NotificationIcon","_jsxRuntime","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ID","exports","NotificationTrigger","_ref","intl","onClick","courseId","notificationStatus","setNotificationStatus","upgradeNotificationCurrentState","useContext","SidebarContext","UpdateUpgradeNotificationLastSeen","getLocalStorage","setLocalStorage","useEffect","handleClick","getSessionStorage","setSessionStorage","jsx","ariaLabel","formatMessage","messages","openNotificationTrigger","children","status","notificationColor","propTypes","intlShape","isRequired","PropTypes","func","_default","injectIntl"],"sources":["../../../../../../src/courseware/course/sidebar/sidebars/notifications/NotificationTrigger.jsx"],"sourcesContent":["import { injectIntl, intlShape } from '@edx/frontend-platform/i18n';\nimport PropTypes from 'prop-types';\nimport React, { useContext, useEffect } from 'react';\nimport { getLocalStorage, setLocalStorage } from '../../../../../data/localStorage';\nimport { getSessionStorage, setSessionStorage } from '../../../../../data/sessionStorage';\nimport messages from '../../../messages';\nimport SidebarTriggerBase from '../../common/TriggerBase';\nimport SidebarContext from '../../SidebarContext';\n\nimport NotificationIcon from './NotificationIcon';\n\nexport const ID = 'NOTIFICATIONS';\n\nconst NotificationTrigger = ({\n  intl,\n  onClick,\n}) => {\n  const {\n    courseId,\n    notificationStatus,\n    setNotificationStatus,\n    upgradeNotificationCurrentState,\n  } = useContext(SidebarContext);\n\n  /* Re-show a red dot beside the notification trigger for each of the 7 UpgradeNotification stages\n   The upgradeNotificationCurrentState prop will be available after UpgradeNotification mounts. Once available,\n  compare with the last state they've seen, and if it's different then set dot back to red */\n  function UpdateUpgradeNotificationLastSeen() {\n    if (upgradeNotificationCurrentState) {\n      if (getLocalStorage(`upgradeNotificationLastSeen.${courseId}`) !== upgradeNotificationCurrentState) {\n        setNotificationStatus('active');\n        setLocalStorage(`notificationStatus.${courseId}`, 'active');\n        setLocalStorage(`upgradeNotificationLastSeen.${courseId}`, upgradeNotificationCurrentState);\n      }\n    }\n  }\n\n  if (!getLocalStorage(`notificationStatus.${courseId}`)) {\n    setLocalStorage(`notificationStatus.${courseId}`, 'active'); // Show red dot on notificationTrigger until seen\n  }\n\n  if (!getLocalStorage(`upgradeNotificationCurrentState.${courseId}`)) {\n    setLocalStorage(`upgradeNotificationCurrentState.${courseId}`, 'initialize');\n  }\n\n  useEffect(() => {\n    UpdateUpgradeNotificationLastSeen();\n  });\n\n  const handleClick = () => {\n    if (getSessionStorage(`notificationTrayStatus.${courseId}`) === 'open') {\n      setSessionStorage(`notificationTrayStatus.${courseId}`, 'closed');\n    } else {\n      setSessionStorage(`notificationTrayStatus.${courseId}`, 'open');\n    }\n    onClick();\n  };\n\n  return (\n    <SidebarTriggerBase onClick={handleClick} ariaLabel={intl.formatMessage(messages.openNotificationTrigger)}>\n      <NotificationIcon status={notificationStatus} notificationColor=\"bg-danger-500\" />\n    </SidebarTriggerBase>\n  );\n};\n\nNotificationTrigger.propTypes = {\n  intl: intlShape.isRequired,\n  onClick: PropTypes.func.isRequired,\n};\n\nexport default injectIntl(NotificationTrigger);\n"],"mappings":"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"}