{"version":3,"file":"redux.test.js","names":["_axiosMockAdapter","_interopRequireDefault","require","_auth","_frontendPlatform","thunks","_interopRequireWildcard","_utils","_setupTest","_store","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","loggingService","initializeMockApp","axiosMock","MockAdapter","getAuthenticatedHttpClient","describe","unitId","store","beforeEach","reset","logError","mockReset","initializeStore","createBookmarkURL","getConfig","LMS_BASE_URL","it","onPost","networkError","executeThunk","addBookmark","dispatch","expect","toHaveBeenCalled","history","post","url","toEqual","getState","models","units","objectContaining","bookmarked","bookmarkedUpdateState","reply","deleteBookmarkURL","getAuthenticatedUser","username","onDelete","removeBookmark","delete"],"sources":["../../../../../src/courseware/course/bookmark/data/redux.test.js"],"sourcesContent":["import MockAdapter from 'axios-mock-adapter';\n\nimport { getAuthenticatedHttpClient, getAuthenticatedUser } from '@edx/frontend-platform/auth';\nimport { getConfig } from '@edx/frontend-platform';\n\nimport * as thunks from './thunks';\n\nimport { executeThunk } from '../../../../utils';\n\nimport { initializeMockApp } from '../../../../setupTest';\nimport initializeStore from '../../../../store';\n\nconst { loggingService } = initializeMockApp();\n\nconst axiosMock = new MockAdapter(getAuthenticatedHttpClient());\n\ndescribe('Data layer integration tests', () => {\n  const unitId = 'unitId';\n\n  let store;\n\n  beforeEach(() => {\n    axiosMock.reset();\n    loggingService.logError.mockReset();\n\n    store = initializeStore();\n  });\n\n  describe('Test addBookmark', () => {\n    const createBookmarkURL = `${getConfig().LMS_BASE_URL}/api/bookmarks/v1/bookmarks/`;\n\n    it('Should fail to create bookmark in case of error', async () => {\n      axiosMock.onPost(createBookmarkURL).networkError();\n\n      await executeThunk(thunks.addBookmark(unitId), store.dispatch);\n\n      expect(loggingService.logError).toHaveBeenCalled();\n      expect(axiosMock.history.post[0].url).toEqual(createBookmarkURL);\n      expect(store.getState().models.units[unitId]).toEqual(expect.objectContaining({\n        bookmarked: false,\n        bookmarkedUpdateState: 'failed',\n      }));\n    });\n\n    it('Should create bookmark and update model state', async () => {\n      axiosMock.onPost(createBookmarkURL).reply(201);\n\n      await executeThunk(thunks.addBookmark(unitId), store.dispatch);\n\n      expect(store.getState().models.units[unitId]).toEqual(expect.objectContaining({\n        bookmarked: true,\n        bookmarkedUpdateState: 'loaded',\n      }));\n    });\n  });\n\n  describe('Test removeBookmark', () => {\n    const deleteBookmarkURL = `${getConfig().LMS_BASE_URL}/api/bookmarks/v1/bookmarks/${getAuthenticatedUser().username},${unitId}/`;\n\n    it('Should fail to remove bookmark in case of error', async () => {\n      axiosMock.onDelete(deleteBookmarkURL).networkError();\n\n      await executeThunk(thunks.removeBookmark(unitId), store.dispatch);\n\n      expect(loggingService.logError).toHaveBeenCalled();\n      expect(axiosMock.history.delete[0].url).toEqual(deleteBookmarkURL);\n      expect(store.getState().models.units[unitId]).toEqual(expect.objectContaining({\n        bookmarked: true,\n        bookmarkedUpdateState: 'failed',\n      }));\n    });\n\n    it('Should delete bookmark and update model state', async () => {\n      axiosMock.onDelete(deleteBookmarkURL).reply(201);\n\n      await executeThunk(thunks.removeBookmark(unitId), store.dispatch);\n\n      expect(store.getState().models.units[unitId]).toEqual(expect.objectContaining({\n        bookmarked: false,\n        bookmarkedUpdateState: 'loaded',\n      }));\n    });\n  });\n});\n"],"mappings":"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"}