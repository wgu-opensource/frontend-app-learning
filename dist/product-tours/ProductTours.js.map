{"version":3,"file":"ProductTours.js","names":["_react","_interopRequireWildcard","require","_reactRedux","_propTypes","_interopRequireDefault","_analytics","_auth","_paragon","_AbandonTour","_CoursewareTour","_ExistingUserCourseHomeTour","_NewUserCourseHomeTour","_NewUserCourseHomeTourModal","_data","_jsxRuntime","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ProductTours","_ref","activeTab","courseId","isStreakCelebrationOpen","org","proctoringPanelStatus","useSelector","state","courseHome","showCoursewareTour","showExistingUserCourseHomeTour","showNewUserCourseHomeModal","showNewUserCourseHomeTour","tours","isAbandonTourEnabled","setIsAbandonTourEnabled","useState","isCoursewareTourEnabled","setIsCoursewareTourEnabled","isExistingUserCourseHomeTourEnabled","setIsExistingUserCourseHomeTourEnabled","isNewUserCourseHomeTourEnabled","setIsNewUserCourseHomeTourEnabled","dispatch","useDispatch","administrator","username","getAuthenticatedUser","isCoursewareTab","isOutlineTab","useEffect","isOutlineTabResolved","userIsAuthenticated","fetchTourData","abandonTour","enabled","onEnd","coursewareTour","sendTrackEvent","org_key","courserun_key","is_staff","endCoursewareTour","existingUserCourseHomeTour","endCourseHomeTour","newUserCourseHomeTour","onDismiss","jsxs","Fragment","children","jsx","ProductTour","isOpen","closeNewUserCourseHomeModal","onStartTour","propTypes","PropTypes","string","isRequired","bool","_default","exports"],"sources":["../../src/product-tours/ProductTours.jsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport { getAuthenticatedUser } from '@edx/frontend-platform/auth';\nimport { ProductTour } from '@edx/paragon';\n\nimport abandonTour from './AbandonTour';\nimport coursewareTour from './CoursewareTour';\nimport existingUserCourseHomeTour from './ExistingUserCourseHomeTour';\nimport newUserCourseHomeTour from './newUserCourseHomeTour/NewUserCourseHomeTour';\nimport NewUserCourseHomeTourModal from './newUserCourseHomeTour/NewUserCourseHomeTourModal';\nimport {\n  closeNewUserCourseHomeModal,\n  endCourseHomeTour,\n  endCoursewareTour,\n  fetchTourData,\n} from './data';\n\nconst ProductTours = ({\n  activeTab,\n  courseId,\n  isStreakCelebrationOpen,\n  org,\n}) => {\n  const {\n    proctoringPanelStatus,\n  } = useSelector(state => state.courseHome);\n\n  const {\n    showCoursewareTour,\n    showExistingUserCourseHomeTour,\n    showNewUserCourseHomeModal,\n    showNewUserCourseHomeTour,\n  } = useSelector(state => state.tours);\n\n  const [isAbandonTourEnabled, setIsAbandonTourEnabled] = useState(false);\n  const [isCoursewareTourEnabled, setIsCoursewareTourEnabled] = useState(false);\n  const [isExistingUserCourseHomeTourEnabled, setIsExistingUserCourseHomeTourEnabled] = useState(false);\n  const [isNewUserCourseHomeTourEnabled, setIsNewUserCourseHomeTourEnabled] = useState(false);\n\n  const dispatch = useDispatch();\n  const {\n    administrator,\n    username,\n  } = getAuthenticatedUser() || {};\n  const isCoursewareTab = activeTab === 'courseware';\n  const isOutlineTab = activeTab === 'outline';\n\n  useEffect(() => {\n    const isOutlineTabResolved = isOutlineTab && proctoringPanelStatus === 'loaded';\n    const userIsAuthenticated = !!username;\n\n    // Tours currently only exist on the Outline Tab and within Courseware, so we'll avoid\n    // calling the tour endpoint unnecessarily.\n    if (userIsAuthenticated && (isCoursewareTab || isOutlineTabResolved)) {\n      dispatch(fetchTourData(username));\n    }\n  }, [proctoringPanelStatus]);\n\n  useEffect(() => {\n    if (isCoursewareTab && showCoursewareTour) {\n      setIsCoursewareTourEnabled(true);\n    }\n  }, [showCoursewareTour]);\n\n  useEffect(() => {\n    if (isOutlineTab) {\n      setIsExistingUserCourseHomeTourEnabled(!!showExistingUserCourseHomeTour);\n    }\n  }, [showExistingUserCourseHomeTour]);\n\n  useEffect(() => {\n    if (isOutlineTab && showNewUserCourseHomeTour) {\n      setIsAbandonTourEnabled(false);\n      setIsNewUserCourseHomeTourEnabled(true);\n    }\n  }, [showNewUserCourseHomeTour]);\n\n  if (isStreakCelebrationOpen) {\n    return null;\n  }\n\n  // The <ProductTour /> component cannot handle rendering multiple enabled tours at once.\n  // I.e. when adding new tours, beware that if multiple tours are enabled,\n  // the first enabled tour in the following array will be the only one that renders.\n  // The suggestion for populating these tour objects is to ensure only one tour is enabled at a time.\n  const tours = [\n    abandonTour({\n      enabled: isAbandonTourEnabled,\n      onEnd: () => setIsAbandonTourEnabled(false),\n    }),\n    coursewareTour({\n      enabled: isCoursewareTourEnabled,\n      onEnd: () => {\n        setIsCoursewareTourEnabled(false);\n        sendTrackEvent('edx.ui.lms.courseware_tour.completed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCoursewareTour(username));\n      },\n    }),\n    existingUserCourseHomeTour({\n      enabled: isExistingUserCourseHomeTourEnabled,\n      onEnd: () => {\n        setIsExistingUserCourseHomeTourEnabled(false);\n        sendTrackEvent('edx.ui.lms.existing_user_tour.completed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCourseHomeTour(username));\n      },\n    }),\n    newUserCourseHomeTour({\n      enabled: isNewUserCourseHomeTourEnabled,\n      onDismiss: () => {\n        setIsNewUserCourseHomeTourEnabled(false);\n        setIsAbandonTourEnabled(true);\n        sendTrackEvent('edx.ui.lms.new_user_tour.dismissed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCourseHomeTour(username));\n        dispatch(endCoursewareTour(username));\n      },\n      onEnd: () => {\n        setIsNewUserCourseHomeTourEnabled(false);\n        sendTrackEvent('edx.ui.lms.new_user_tour.completed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCourseHomeTour(username));\n      },\n    }),\n  ];\n\n  return (\n    <>\n      <ProductTour\n        tours={tours}\n      />\n      <NewUserCourseHomeTourModal\n        isOpen={isOutlineTab && showNewUserCourseHomeModal}\n        onDismiss={() => {\n          sendTrackEvent('edx.ui.lms.new_user_modal.dismissed', {\n            org_key: org,\n            courserun_key: courseId,\n            is_staff: administrator,\n          });\n          dispatch(closeNewUserCourseHomeModal());\n          setIsAbandonTourEnabled(true);\n          dispatch(endCourseHomeTour(username));\n        }}\n        onStartTour={() => {\n          sendTrackEvent('edx.ui.lms.new_user_tour.started', {\n            org_key: org,\n            courserun_key: courseId,\n            is_staff: administrator,\n          });\n          dispatch(closeNewUserCourseHomeModal());\n          setIsNewUserCourseHomeTourEnabled(true);\n        }}\n      />\n    </>\n  );\n};\n\nProductTours.propTypes = {\n  activeTab: PropTypes.string.isRequired,\n  courseId: PropTypes.string.isRequired,\n  isStreakCelebrationOpen: PropTypes.bool.isRequired,\n  org: PropTypes.string.isRequired,\n};\n\nexport default ProductTours;\n"],"mappings":";;;;;;AACA,IAAAA,MAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,UAAA,GAAAC,sBAAA,CAAAH,OAAA;AACA,IAAAI,UAAA,GAAAJ,OAAA;AACA,IAAAK,KAAA,GAAAL,OAAA;AACA,IAAAM,QAAA,GAAAN,OAAA;AAEA,IAAAO,YAAA,GAAAJ,sBAAA,CAAAH,OAAA;AACA,IAAAQ,eAAA,GAAAL,sBAAA,CAAAH,OAAA;AACA,IAAAS,2BAAA,GAAAN,sBAAA,CAAAH,OAAA;AACA,IAAAU,sBAAA,GAAAP,sBAAA,CAAAH,OAAA;AACA,IAAAW,2BAAA,GAAAR,sBAAA,CAAAH,OAAA;AACA,IAAAY,KAAA,GAAAZ,OAAA;AAKgB,IAAAa,WAAA,GAAAb,OAAA;AAAA,SAAAG,uBAAAW,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAAA,SAAAG,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAnB,wBAAAe,GAAA,EAAAI,WAAA,SAAAA,WAAA,IAAAJ,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAQ,KAAA,GAAAL,wBAAA,CAAAC,WAAA,OAAAI,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAT,GAAA,YAAAQ,KAAA,CAAAE,GAAA,CAAAV,GAAA,SAAAW,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAhB,GAAA,QAAAgB,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAnB,GAAA,EAAAgB,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAf,GAAA,EAAAgB,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAhB,GAAA,CAAAgB,GAAA,SAAAL,MAAA,CAAAT,OAAA,GAAAF,GAAA,MAAAQ,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAArB,GAAA,EAAAW,MAAA,YAAAA,MAAA;AAlBhB;;AAoBA,MAAMW,YAAY,GAAGC,IAAA,IAKf;EAAA,IALgB;IACpBC,SAAS;IACTC,QAAQ;IACRC,uBAAuB;IACvBC;EACF,CAAC,GAAAJ,IAAA;EACC,MAAM;IACJK;EACF,CAAC,GAAG,IAAAC,uBAAW,EAACC,KAAK,IAAIA,KAAK,CAACC,UAAU,CAAC;EAE1C,MAAM;IACJC,kBAAkB;IAClBC,8BAA8B;IAC9BC,0BAA0B;IAC1BC;EACF,CAAC,GAAG,IAAAN,uBAAW,EAACC,KAAK,IAAIA,KAAK,CAACM,KAAK,CAAC;EAErC,MAAM,CAACC,oBAAoB,EAAEC,uBAAuB,CAAC,GAAG,IAAAC,eAAQ,EAAC,KAAK,CAAC;EACvE,MAAM,CAACC,uBAAuB,EAAEC,0BAA0B,CAAC,GAAG,IAAAF,eAAQ,EAAC,KAAK,CAAC;EAC7E,MAAM,CAACG,mCAAmC,EAAEC,sCAAsC,CAAC,GAAG,IAAAJ,eAAQ,EAAC,KAAK,CAAC;EACrG,MAAM,CAACK,8BAA8B,EAAEC,iCAAiC,CAAC,GAAG,IAAAN,eAAQ,EAAC,KAAK,CAAC;EAE3F,MAAMO,QAAQ,GAAG,IAAAC,uBAAW,EAAC,CAAC;EAC9B,MAAM;IACJC,aAAa;IACbC;EACF,CAAC,GAAG,IAAAC,0BAAoB,EAAC,CAAC,IAAI,CAAC,CAAC;EAChC,MAAMC,eAAe,GAAG3B,SAAS,KAAK,YAAY;EAClD,MAAM4B,YAAY,GAAG5B,SAAS,KAAK,SAAS;EAE5C,IAAA6B,gBAAS,EAAC,MAAM;IACd,MAAMC,oBAAoB,GAAGF,YAAY,IAAIxB,qBAAqB,KAAK,QAAQ;IAC/E,MAAM2B,mBAAmB,GAAG,CAAC,CAACN,QAAQ;;IAEtC;IACA;IACA,IAAIM,mBAAmB,KAAKJ,eAAe,IAAIG,oBAAoB,CAAC,EAAE;MACpER,QAAQ,CAAC,IAAAU,mBAAa,EAACP,QAAQ,CAAC,CAAC;IACnC;EACF,CAAC,EAAE,CAACrB,qBAAqB,CAAC,CAAC;EAE3B,IAAAyB,gBAAS,EAAC,MAAM;IACd,IAAIF,eAAe,IAAInB,kBAAkB,EAAE;MACzCS,0BAA0B,CAAC,IAAI,CAAC;IAClC;EACF,CAAC,EAAE,CAACT,kBAAkB,CAAC,CAAC;EAExB,IAAAqB,gBAAS,EAAC,MAAM;IACd,IAAID,YAAY,EAAE;MAChBT,sCAAsC,CAAC,CAAC,CAACV,8BAA8B,CAAC;IAC1E;EACF,CAAC,EAAE,CAACA,8BAA8B,CAAC,CAAC;EAEpC,IAAAoB,gBAAS,EAAC,MAAM;IACd,IAAID,YAAY,IAAIjB,yBAAyB,EAAE;MAC7CG,uBAAuB,CAAC,KAAK,CAAC;MAC9BO,iCAAiC,CAAC,IAAI,CAAC;IACzC;EACF,CAAC,EAAE,CAACV,yBAAyB,CAAC,CAAC;EAE/B,IAAIT,uBAAuB,EAAE;IAC3B,OAAO,IAAI;EACb;;EAEA;EACA;EACA;EACA;EACA,MAAMU,KAAK,GAAG,CACZ,IAAAqB,oBAAW,EAAC;IACVC,OAAO,EAAErB,oBAAoB;IAC7BsB,KAAK,EAAEA,CAAA,KAAMrB,uBAAuB,CAAC,KAAK;EAC5C,CAAC,CAAC,EACF,IAAAsB,uBAAc,EAAC;IACbF,OAAO,EAAElB,uBAAuB;IAChCmB,KAAK,EAAEA,CAAA,KAAM;MACXlB,0BAA0B,CAAC,KAAK,CAAC;MACjC,IAAAoB,yBAAc,EAAC,sCAAsC,EAAE;QACrDC,OAAO,EAAEnC,GAAG;QACZoC,aAAa,EAAEtC,QAAQ;QACvBuC,QAAQ,EAAEhB;MACZ,CAAC,CAAC;MACFF,QAAQ,CAAC,IAAAmB,uBAAiB,EAAChB,QAAQ,CAAC,CAAC;IACvC;EACF,CAAC,CAAC,EACF,IAAAiB,mCAA0B,EAAC;IACzBR,OAAO,EAAEhB,mCAAmC;IAC5CiB,KAAK,EAAEA,CAAA,KAAM;MACXhB,sCAAsC,CAAC,KAAK,CAAC;MAC7C,IAAAkB,yBAAc,EAAC,yCAAyC,EAAE;QACxDC,OAAO,EAAEnC,GAAG;QACZoC,aAAa,EAAEtC,QAAQ;QACvBuC,QAAQ,EAAEhB;MACZ,CAAC,CAAC;MACFF,QAAQ,CAAC,IAAAqB,uBAAiB,EAAClB,QAAQ,CAAC,CAAC;IACvC;EACF,CAAC,CAAC,EACF,IAAAmB,8BAAqB,EAAC;IACpBV,OAAO,EAAEd,8BAA8B;IACvCyB,SAAS,EAAEA,CAAA,KAAM;MACfxB,iCAAiC,CAAC,KAAK,CAAC;MACxCP,uBAAuB,CAAC,IAAI,CAAC;MAC7B,IAAAuB,yBAAc,EAAC,oCAAoC,EAAE;QACnDC,OAAO,EAAEnC,GAAG;QACZoC,aAAa,EAAEtC,QAAQ;QACvBuC,QAAQ,EAAEhB;MACZ,CAAC,CAAC;MACFF,QAAQ,CAAC,IAAAqB,uBAAiB,EAAClB,QAAQ,CAAC,CAAC;MACrCH,QAAQ,CAAC,IAAAmB,uBAAiB,EAAChB,QAAQ,CAAC,CAAC;IACvC,CAAC;IACDU,KAAK,EAAEA,CAAA,KAAM;MACXd,iCAAiC,CAAC,KAAK,CAAC;MACxC,IAAAgB,yBAAc,EAAC,oCAAoC,EAAE;QACnDC,OAAO,EAAEnC,GAAG;QACZoC,aAAa,EAAEtC,QAAQ;QACvBuC,QAAQ,EAAEhB;MACZ,CAAC,CAAC;MACFF,QAAQ,CAAC,IAAAqB,uBAAiB,EAAClB,QAAQ,CAAC,CAAC;IACvC;EACF,CAAC,CAAC,CACH;EAED,oBACE,IAAAlD,WAAA,CAAAuE,IAAA,EAAAvE,WAAA,CAAAwE,QAAA;IAAAC,QAAA,gBACE,IAAAzE,WAAA,CAAA0E,GAAA,EAACjF,QAAA,CAAAkF,WAAW;MACVtC,KAAK,EAAEA;IAAM,CACd,CAAC,eACF,IAAArC,WAAA,CAAA0E,GAAA,EAAC5E,2BAAA,CAAAK,OAA0B;MACzByE,MAAM,EAAEvB,YAAY,IAAIlB,0BAA2B;MACnDmC,SAAS,EAAEA,CAAA,KAAM;QACf,IAAAR,yBAAc,EAAC,qCAAqC,EAAE;UACpDC,OAAO,EAAEnC,GAAG;UACZoC,aAAa,EAAEtC,QAAQ;UACvBuC,QAAQ,EAAEhB;QACZ,CAAC,CAAC;QACFF,QAAQ,CAAC,IAAA8B,iCAA2B,EAAC,CAAC,CAAC;QACvCtC,uBAAuB,CAAC,IAAI,CAAC;QAC7BQ,QAAQ,CAAC,IAAAqB,uBAAiB,EAAClB,QAAQ,CAAC,CAAC;MACvC,CAAE;MACF4B,WAAW,EAAEA,CAAA,KAAM;QACjB,IAAAhB,yBAAc,EAAC,kCAAkC,EAAE;UACjDC,OAAO,EAAEnC,GAAG;UACZoC,aAAa,EAAEtC,QAAQ;UACvBuC,QAAQ,EAAEhB;QACZ,CAAC,CAAC;QACFF,QAAQ,CAAC,IAAA8B,iCAA2B,EAAC,CAAC,CAAC;QACvC/B,iCAAiC,CAAC,IAAI,CAAC;MACzC;IAAE,CACH,CAAC;EAAA,CACF,CAAC;AAEP,CAAC;AAEDvB,YAAY,CAACwD,SAAS,GAAG;EACvBtD,SAAS,EAAEuD,kBAAS,CAACC,MAAM,CAACC,UAAU;EACtCxD,QAAQ,EAAEsD,kBAAS,CAACC,MAAM,CAACC,UAAU;EACrCvD,uBAAuB,EAAEqD,kBAAS,CAACG,IAAI,CAACD,UAAU;EAClDtD,GAAG,EAAEoD,kBAAS,CAACC,MAAM,CAACC;AACxB,CAAC;AAAC,IAAAE,QAAA,GAEa7D,YAAY;AAAA8D,OAAA,CAAAlF,OAAA,GAAAiF,QAAA"}