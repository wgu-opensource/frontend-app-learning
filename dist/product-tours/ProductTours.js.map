{"version":3,"sources":["../../src/product-tours/ProductTours.jsx"],"names":["ProductTours","activeTab","courseId","isStreakCelebrationOpen","org","proctoringPanelStatus","state","courseHome","showCoursewareTour","showExistingUserCourseHomeTour","showNewUserCourseHomeModal","showNewUserCourseHomeTour","tours","isAbandonTourEnabled","setIsAbandonTourEnabled","isCoursewareTourEnabled","setIsCoursewareTourEnabled","isExistingUserCourseHomeTourEnabled","setIsExistingUserCourseHomeTourEnabled","isNewUserCourseHomeTourEnabled","setIsNewUserCourseHomeTourEnabled","dispatch","administrator","username","isCoursewareTab","isOutlineTab","isOutlineTabResolved","userIsAuthenticated","enabled","onEnd","org_key","courserun_key","is_staff","onDismiss","propTypes","PropTypes","string","isRequired","bool"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAOA,SAASA,YAAT,OAKG;AAAA,MALmB;AACpBC,IAAAA,SADoB;AAEpBC,IAAAA,QAFoB;AAGpBC,IAAAA,uBAHoB;AAIpBC,IAAAA;AAJoB,GAKnB;;AACD,MAAID,uBAAJ,EAA6B;AAC3B,WAAO,IAAP;AACD;;AAED,QAAM;AACJE,IAAAA;AADI,MAEF,6BAAYC,KAAK,IAAIA,KAAK,CAACC,UAA3B,CAFJ;AAIA,QAAM;AACJC,IAAAA,kBADI;AAEJC,IAAAA,8BAFI;AAGJC,IAAAA,0BAHI;AAIJC,IAAAA;AAJI,MAKF,6BAAYL,KAAK,IAAIA,KAAK,CAACM,KAA3B,CALJ;AAOA,QAAM,CAACC,oBAAD,EAAuBC,uBAAvB,IAAkD,qBAAS,KAAT,CAAxD;AACA,QAAM,CAACC,uBAAD,EAA0BC,0BAA1B,IAAwD,qBAAS,KAAT,CAA9D;AACA,QAAM,CAACC,mCAAD,EAAsCC,sCAAtC,IAAgF,qBAAS,KAAT,CAAtF;AACA,QAAM,CAACC,8BAAD,EAAiCC,iCAAjC,IAAsE,qBAAS,KAAT,CAA5E;AAEA,QAAMC,QAAQ,GAAG,8BAAjB;AACA,QAAM;AACJC,IAAAA,aADI;AAEJC,IAAAA;AAFI,MAGF,qCAA0B,EAH9B;AAIA,QAAMC,eAAe,GAAGvB,SAAS,KAAK,YAAtC;AACA,QAAMwB,YAAY,GAAGxB,SAAS,KAAK,SAAnC;AAEA,wBAAU,MAAM;AACd,UAAMyB,oBAAoB,GAAGD,YAAY,IAAIpB,qBAAqB,KAAK,QAAvE;AACA,UAAMsB,mBAAmB,GAAG,CAAC,CAACJ,QAA9B,CAFc,CAId;AACA;;AACA,QAAII,mBAAmB,KAAKH,eAAe,IAAIE,oBAAxB,CAAvB,EAAsE;AACpEL,MAAAA,QAAQ,CAAC,yBAAcE,QAAd,CAAD,CAAR;AACD;AACF,GATD,EASG,CAAClB,qBAAD,CATH;AAWA,wBAAU,MAAM;AACd,QAAImB,eAAe,IAAIhB,kBAAvB,EAA2C;AACzCQ,MAAAA,0BAA0B,CAAC,IAAD,CAA1B;AACD;AACF,GAJD,EAIG,CAACR,kBAAD,CAJH;AAMA,wBAAU,MAAM;AACd,QAAIiB,YAAJ,EAAkB;AAChBP,MAAAA,sCAAsC,CAAC,CAAC,CAACT,8BAAH,CAAtC;AACD;AACF,GAJD,EAIG,CAACA,8BAAD,CAJH;AAMA,wBAAU,MAAM;AACd,QAAIgB,YAAY,IAAId,yBAApB,EAA+C;AAC7CG,MAAAA,uBAAuB,CAAC,KAAD,CAAvB;AACAM,MAAAA,iCAAiC,CAAC,IAAD,CAAjC;AACD;AACF,GALD,EAKG,CAACT,yBAAD,CALH,EApDC,CA2DD;AACA;AACA;AACA;;AACA,QAAMC,KAAK,GAAG,CACZ,0BAAY;AACVgB,IAAAA,OAAO,EAAEf,oBADC;AAEVgB,IAAAA,KAAK,EAAE,MAAMf,uBAAuB,CAAC,KAAD;AAF1B,GAAZ,CADY,EAKZ,6BAAe;AACbc,IAAAA,OAAO,EAAEb,uBADI;AAEbc,IAAAA,KAAK,EAAE,MAAM;AACXb,MAAAA,0BAA0B,CAAC,KAAD,CAA1B;AACA,qCAAe,sCAAf,EAAuD;AACrDc,QAAAA,OAAO,EAAE1B,GAD4C;AAErD2B,QAAAA,aAAa,EAAE7B,QAFsC;AAGrD8B,QAAAA,QAAQ,EAAEV;AAH2C,OAAvD;AAKAD,MAAAA,QAAQ,CAAC,6BAAkBE,QAAlB,CAAD,CAAR;AACD;AAVY,GAAf,CALY,EAiBZ,yCAA2B;AACzBK,IAAAA,OAAO,EAAEX,mCADgB;AAEzBY,IAAAA,KAAK,EAAE,MAAM;AACXX,MAAAA,sCAAsC,CAAC,KAAD,CAAtC;AACA,qCAAe,yCAAf,EAA0D;AACxDY,QAAAA,OAAO,EAAE1B,GAD+C;AAExD2B,QAAAA,aAAa,EAAE7B,QAFyC;AAGxD8B,QAAAA,QAAQ,EAAEV;AAH8C,OAA1D;AAKAD,MAAAA,QAAQ,CAAC,6BAAkBE,QAAlB,CAAD,CAAR;AACD;AAVwB,GAA3B,CAjBY,EA6BZ,oCAAsB;AACpBK,IAAAA,OAAO,EAAET,8BADW;AAEpBc,IAAAA,SAAS,EAAE,MAAM;AACfb,MAAAA,iCAAiC,CAAC,KAAD,CAAjC;AACAN,MAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACA,qCAAe,oCAAf,EAAqD;AACnDgB,QAAAA,OAAO,EAAE1B,GAD0C;AAEnD2B,QAAAA,aAAa,EAAE7B,QAFoC;AAGnD8B,QAAAA,QAAQ,EAAEV;AAHyC,OAArD;AAKAD,MAAAA,QAAQ,CAAC,6BAAkBE,QAAlB,CAAD,CAAR;AACAF,MAAAA,QAAQ,CAAC,6BAAkBE,QAAlB,CAAD,CAAR;AACD,KAZmB;AAapBM,IAAAA,KAAK,EAAE,MAAM;AACXT,MAAAA,iCAAiC,CAAC,KAAD,CAAjC;AACA,qCAAe,oCAAf,EAAqD;AACnDU,QAAAA,OAAO,EAAE1B,GAD0C;AAEnD2B,QAAAA,aAAa,EAAE7B,QAFoC;AAGnD8B,QAAAA,QAAQ,EAAEV;AAHyC,OAArD;AAKAD,MAAAA,QAAQ,CAAC,6BAAkBE,QAAlB,CAAD,CAAR;AACD;AArBmB,GAAtB,CA7BY,CAAd;AAsDA,sBACE;AAAA,4BACE,qBAAC,oBAAD;AACE,MAAA,KAAK,EAAEX;AADT,MADF,eAIE,qBAAC,mCAAD;AACE,MAAA,MAAM,EAAEa,YAAY,IAAIf,0BAD1B;AAEE,MAAA,SAAS,EAAE,MAAM;AACf,uCAAe,qCAAf,EAAsD;AACpDoB,UAAAA,OAAO,EAAE1B,GAD2C;AAEpD2B,UAAAA,aAAa,EAAE7B,QAFqC;AAGpD8B,UAAAA,QAAQ,EAAEV;AAH0C,SAAtD;AAKAD,QAAAA,QAAQ,CAAC,wCAAD,CAAR;AACAP,QAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACAO,QAAAA,QAAQ,CAAC,6BAAkBE,QAAlB,CAAD,CAAR;AACD,OAXH;AAYE,MAAA,WAAW,EAAE,MAAM;AACjB,uCAAe,kCAAf,EAAmD;AACjDO,UAAAA,OAAO,EAAE1B,GADwC;AAEjD2B,UAAAA,aAAa,EAAE7B,QAFkC;AAGjD8B,UAAAA,QAAQ,EAAEV;AAHuC,SAAnD;AAKAD,QAAAA,QAAQ,CAAC,wCAAD,CAAR;AACAD,QAAAA,iCAAiC,CAAC,IAAD,CAAjC;AACD;AApBH,MAJF;AAAA,IADF;AA6BD;;AAEDpB,YAAY,CAACkC,SAAb,GAAyB;AACvBjC,EAAAA,SAAS,EAAEkC,mBAAUC,MAAV,CAAiBC,UADL;AAEvBnC,EAAAA,QAAQ,EAAEiC,mBAAUC,MAAV,CAAiBC,UAFJ;AAGvBlC,EAAAA,uBAAuB,EAAEgC,mBAAUG,IAAV,CAAeD,UAHjB;AAIvBjC,EAAAA,GAAG,EAAE+B,mBAAUC,MAAV,CAAiBC;AAJC,CAAzB;eAOerC,Y","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport { getAuthenticatedUser } from '@edx/frontend-platform/auth';\nimport { ProductTour } from '@edx/paragon';\n\nimport abandonTour from './AbandonTour';\nimport coursewareTour from './CoursewareTour';\nimport existingUserCourseHomeTour from './ExistingUserCourseHomeTour';\nimport newUserCourseHomeTour from './newUserCourseHomeTour/NewUserCourseHomeTour';\nimport NewUserCourseHomeTourModal from './newUserCourseHomeTour/NewUserCourseHomeTourModal';\nimport {\n  closeNewUserCourseHomeModal,\n  endCourseHomeTour,\n  endCoursewareTour,\n  fetchTourData,\n} from './data';\n\nfunction ProductTours({\n  activeTab,\n  courseId,\n  isStreakCelebrationOpen,\n  org,\n}) {\n  if (isStreakCelebrationOpen) {\n    return null;\n  }\n\n  const {\n    proctoringPanelStatus,\n  } = useSelector(state => state.courseHome);\n\n  const {\n    showCoursewareTour,\n    showExistingUserCourseHomeTour,\n    showNewUserCourseHomeModal,\n    showNewUserCourseHomeTour,\n  } = useSelector(state => state.tours);\n\n  const [isAbandonTourEnabled, setIsAbandonTourEnabled] = useState(false);\n  const [isCoursewareTourEnabled, setIsCoursewareTourEnabled] = useState(false);\n  const [isExistingUserCourseHomeTourEnabled, setIsExistingUserCourseHomeTourEnabled] = useState(false);\n  const [isNewUserCourseHomeTourEnabled, setIsNewUserCourseHomeTourEnabled] = useState(false);\n\n  const dispatch = useDispatch();\n  const {\n    administrator,\n    username,\n  } = getAuthenticatedUser() || {};\n  const isCoursewareTab = activeTab === 'courseware';\n  const isOutlineTab = activeTab === 'outline';\n\n  useEffect(() => {\n    const isOutlineTabResolved = isOutlineTab && proctoringPanelStatus === 'loaded';\n    const userIsAuthenticated = !!username;\n\n    // Tours currently only exist on the Outline Tab and within Courseware, so we'll avoid\n    // calling the tour endpoint unnecessarily.\n    if (userIsAuthenticated && (isCoursewareTab || isOutlineTabResolved)) {\n      dispatch(fetchTourData(username));\n    }\n  }, [proctoringPanelStatus]);\n\n  useEffect(() => {\n    if (isCoursewareTab && showCoursewareTour) {\n      setIsCoursewareTourEnabled(true);\n    }\n  }, [showCoursewareTour]);\n\n  useEffect(() => {\n    if (isOutlineTab) {\n      setIsExistingUserCourseHomeTourEnabled(!!showExistingUserCourseHomeTour);\n    }\n  }, [showExistingUserCourseHomeTour]);\n\n  useEffect(() => {\n    if (isOutlineTab && showNewUserCourseHomeTour) {\n      setIsAbandonTourEnabled(false);\n      setIsNewUserCourseHomeTourEnabled(true);\n    }\n  }, [showNewUserCourseHomeTour]);\n\n  // The <ProductTour /> component cannot handle rendering multiple enabled tours at once.\n  // I.e. when adding new tours, beware that if multiple tours are enabled,\n  // the first enabled tour in the following array will be the only one that renders.\n  // The suggestion for populating these tour objects is to ensure only one tour is enabled at a time.\n  const tours = [\n    abandonTour({\n      enabled: isAbandonTourEnabled,\n      onEnd: () => setIsAbandonTourEnabled(false),\n    }),\n    coursewareTour({\n      enabled: isCoursewareTourEnabled,\n      onEnd: () => {\n        setIsCoursewareTourEnabled(false);\n        sendTrackEvent('edx.ui.lms.courseware_tour.completed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCoursewareTour(username));\n      },\n    }),\n    existingUserCourseHomeTour({\n      enabled: isExistingUserCourseHomeTourEnabled,\n      onEnd: () => {\n        setIsExistingUserCourseHomeTourEnabled(false);\n        sendTrackEvent('edx.ui.lms.existing_user_tour.completed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCourseHomeTour(username));\n      },\n    }),\n    newUserCourseHomeTour({\n      enabled: isNewUserCourseHomeTourEnabled,\n      onDismiss: () => {\n        setIsNewUserCourseHomeTourEnabled(false);\n        setIsAbandonTourEnabled(true);\n        sendTrackEvent('edx.ui.lms.new_user_tour.dismissed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCourseHomeTour(username));\n        dispatch(endCoursewareTour(username));\n      },\n      onEnd: () => {\n        setIsNewUserCourseHomeTourEnabled(false);\n        sendTrackEvent('edx.ui.lms.new_user_tour.completed', {\n          org_key: org,\n          courserun_key: courseId,\n          is_staff: administrator,\n        });\n        dispatch(endCourseHomeTour(username));\n      },\n    }),\n  ];\n\n  return (\n    <>\n      <ProductTour\n        tours={tours}\n      />\n      <NewUserCourseHomeTourModal\n        isOpen={isOutlineTab && showNewUserCourseHomeModal}\n        onDismiss={() => {\n          sendTrackEvent('edx.ui.lms.new_user_modal.dismissed', {\n            org_key: org,\n            courserun_key: courseId,\n            is_staff: administrator,\n          });\n          dispatch(closeNewUserCourseHomeModal());\n          setIsAbandonTourEnabled(true);\n          dispatch(endCourseHomeTour(username));\n        }}\n        onStartTour={() => {\n          sendTrackEvent('edx.ui.lms.new_user_tour.started', {\n            org_key: org,\n            courserun_key: courseId,\n            is_staff: administrator,\n          });\n          dispatch(closeNewUserCourseHomeModal());\n          setIsNewUserCourseHomeTourEnabled(true);\n        }}\n      />\n    </>\n  );\n}\n\nProductTours.propTypes = {\n  activeTab: PropTypes.string.isRequired,\n  courseId: PropTypes.string.isRequired,\n  isStreakCelebrationOpen: PropTypes.bool.isRequired,\n  org: PropTypes.string.isRequired,\n};\n\nexport default ProductTours;\n"],"file":"ProductTours.js"}